# VKgetFriendsReport

## Инструкция по запуску

Для запуска скрипта потребуется склонировать репозиторий на ваш локальный компьютер одним из методов:

- git clone https://github.com/Oleggg2000/VKgetFriendsReport.git
- Кнопкой Download ZIP через выпадающее меню Code.

Далее нужно создать виртуальное окружение с помощью модуля virtualenv:

- Если у вас не установлен модуль virtualenv, то выполните команду **pip install virtualenv**.
- Следующим шагом выполнить команду **python3 -m venv my_venv**, где параметр my_venv - это
 папка для установки зависимостей.
- Теперь активируем виртуальное пространство команой: **my_venv\Scripts\activate.bat** - для Windows и 
**source my_venv/bin/activate** - для Linux.

Если удалось активировать виртуальное пространство, то вы увидите в консоли название вашего окружения в скобочках 
Например: **(my_venv) root@purplegate:/**

Затем нужно установить все зависимости для работы скрипта одним из методов:

- Выполнить команду **pip install module1 module2 ....**, где module - это назваие модулей, которые можно 
найти в файле requirements.txt
- Либо выполнить установку с помощью файла requirement.txt с помощью команды 
**pip install -r requirements.txt**

Также после настройки окружения и зависимостей нужно внести в файл **config.py** свой аунтификационный токен 
(ACCESS_TOKEN), который можно получить посредством перехода по ссылке https://oauth.vk.com/authorize?client_id=5490057&display=page&redirect_uri=https://oauth.vk.com/blank.html&scope=friends&response_type=token&v=5.52
, где число 5490057 в запросе нужно заменить на API_ID вашего приложения, которое вы создали для работы с API VK. 
А также USER_ID для кого будет создаваться отчет. Например: https://vk.com/id2677959. Все, что после id и будет USER_ID.
Болье информации можно узнать по ссылке https://vk.com/dev/first_guide в разделе 3. Авторизация пользователя

После выполнения всех действий скрипт можно запускать как с помощью консоли с параметрами или без, так и с помощью
средств IDE.

Запуск програмы из консоли производится посредством команды **python api_vk.py arg1 arg2**, где 
arg1 - это формат выходного отчета, arg2 - путь к выходному файлу. Также её можно запустить без параметров 
**python api_vk.py**, тогда формат по умолчанию будет CSV, а файл будет создаваться в корне проекта с названием report.

## Описание работы скрипта

### API енд-поинт

В моей программе используется только один енд-поинт для метода GET протокола HTTP это 
*https://api.vk.com/method/friends.get?v=5.131&fields=country,city,bdate,sex&order=name&access_token={access_token}
&user_id={user_id}*, где access_token - это токен доступа к API и user_id - это id пользователя, для 
которого плучаем запрос. Если user_id не указан, то берется по умолчанию айди, использованный для создания токена.

Параметры метода friends.get:
- v - 5.131 это актуальная версия API на момент написание скрипта
- user_id - идентификатор пользователя, для которого необходимо получить список друзей. Если параметр не задан, то 
считается, что он равен идентификатору текущего пользователя (справедливо для вызова с передачей access_token).
Целое число.
- order - порядок, в котором нужно вернуть список друзей. Допустимые значения: hints — сортировать по рейтингу, 
аналогично тому, как друзья сортируются в разделе Мои друзья (Это значение доступно только для Standalone-приложений 
с ключом доступа, полученным по схеме Implicit Flow.).
random — возвращает друзей в случайном порядке. name — сортировать по имени. Данный тип сортировки работает медленно, 
так как сервер будет получать всех друзей а не только указанное количество count. 
(работает только при переданном параметре fields). По умолчанию список сортируется в порядке возрастания идентификаторов пользователей.
Строка.
- count - количество друзей, которое нужно вернуть. Положительное число, по умолчанию 5000.
- fields - список дополнительных полей, которые необходимо вернуть.
Доступные значения: nickname, domain, sex, bdate, city, country, timezone, photo_50, photo_100, photo_200_orig, 
has_mobile, contacts, education, online, relation, last_seen, status, can_write_private_message, can_see_all_posts, 
can_post, universities Список слов, разделенных через запятую.
- access_token - это токен доступа к API.
- user_id - это id пользователя, для которого запрашиваем метод.

Больше информации можно узнать по ссылке: https://vk.com/dev/friends.get

### Функции:

В программе присутствует три функции:

- friends_report - главная функция, которая по сути является точкой входа в программу. Функция принимает такие 
аргументы, как access_token - это токен доступа к API, user_id - это id пользователя, для которого формируем отчет, 
outcomes_format - формат предоставления отчета (значение по умолчанию csv) и outcomes_path - это путь к файлу и его имя
(по умолчанию сохраняется в корневую директорию проекта с названием report).
- csv_tsv_reports - Функция, которая создает отчеты в фортатах csv и tsv. Функция принимает такие 
аргументы, как res_ - это GET метод протокола HTTP, который несес в себе информацию по API энд-поинту,
format_ - cvs или tsv форматы и path_ - путь, где создать файл и его название.
- json_report - Функция, которая создает отчет в фортате json. Функция принимает такие 
аргументы, как res_ - это GET метод протокола HTTP, который несес в себе информацию по API энд-поинту и
path_ - путь, где создать файл и его название.

### Дополнительно реализовано

Также в коде реализована пагинация, так как друзей может быть много, они могут не влезть на одну страницу, и
тогда отчет будет неполным. Для этого созданы две константы CSV_TSV_PAGINATION_NUM и JSON_PAGINATION_NUM, которые и 
разделяют данные в разлияные файлы по их количесву.

В системе присутстуют логи, по которым можно отследить состояние системы во время
выполнения. Все логи находятся в файле logs.log данного репозитория. Этот файл не перезаписывается, а дополняется при 
каждом запуске программы.
